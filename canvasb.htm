

<html>
<title> Canvas Page </title>
<script type="text/javascript">	
	dotter=0;
	dotx=[];
	doty=[];
	place=0;
	temp=0;
	redx=[];
	redy=[];
	redder=0;
	addedx=[];
	addedy=[];
	added=0;
	reda=0;
	controlled=0;
	isdot=0;
	dotdragged=0;
	whichdot=0;
	selectype=0; //0 is dot 1 is rect
	selected=0;
	selectarr=[];
	selectdotplace=0;
	redindex=[];
	dragdo=0;

	function init()
	{	
		canvas=document.getElementById("myCan");
		ctx=canvas.getContext('2d');
		rectarr=[];
		drag=false;
		canvas.addEventListener("mousedown", mouseDown, false);
		canvas.addEventListener("mouseup", mouseUp, false);
		canvas.addEventListener("mousemove", mouseMove, false);
		canvas.setAttribute('tabindex','0');
		canvas.focus();
		canvas.addEventListener("keydown", controla, false);
		canvas.addEventListener("keyup", controlb, false);
	}
	function checkdot()
	{
		for(temp=0;temp<place;temp++)
		{
			var checkx=Math.abs(rectarr[0]-dotx[temp]);
			var checky=Math.abs(rectarr[1]-doty[temp]);
			checkx=checkx*checkx;
			checky=checky*checky;
			var checkr=checkx+checky;
			if(checkr<64)
			{
				whichdot=temp;
				isdot=1;
			}
		}
			if(controlled==1)
			{
				dragdo=1;
			}
			for(temp=0;temp<redder;temp++)
			{
				if(redindex[temp]==whichdot)
				{
					dragdo=1;
				}
			}
	}
	function mouseDown(event)
	{
		added=redder;
		if(selected==1)
		{
			if(controlled==0)
			{
				selected=0;
				ctx.clearRect(0,0,canvas.width,canvas.height);
				for(temp=0;temp<place;temp++)
				{
					ctx.beginPath();
					ctx.fillStyle="#000000"; 
					ctx.strokeStyle="#000000";
					ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
				
			}
		}
		rectarr[0]=event.pageX-canvas.offsetLeft;
		rectarr[1]=event.pageY-canvas.offsetTop;
		checkdot();
		if(isdot==1)
		{
			dotdragged=1;
			selectarr[0]=rectarr[0];
			selectarr[1]=rectarr[1];
			selectdotplace=whichdot;
			selected=1;
			selectype=0;
///selected
			ctx.beginPath();
			ctx.fillStyle="#FF0000"; 
			ctx.strokeStyle="#FF0000";
			if(controlled==1)
			{
				redx[redder]=dotx[selectdotplace];
				redy[redder]=doty[selectdotplace];
				redindex[redder]=selectdotplace;
				redder++;
			}
			else
			{
				redx=[];
				redy=[];
				redindex=[];
				redder=0;
				redx[redder]=dotx[selectdotplace];
				redy[redder]=doty[selectdotplace];
				redindex[redder]=selectdotplace;
				redder++;
			}
			ctx.arc(dotx[selectdotplace],doty[selectdotplace],8,0,2*Math.PI);
			ctx.fill();
			ctx.stroke();
		}
		else
		{
			if(controlled==0)
			{
				for(temp=0;temp<place;temp++)
				{
					ctx.beginPath();
					ctx.fillStyle="#000000"; 
					ctx.strokeStyle="#000000";
					ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
				selectarr[0]=rectarr[0];
				selectarr[1]=rectarr[1];
				redx=[];
				redy=[];
				redindex=[];
				redder=0;
				redx[redder]=rectarr[0];
				redy[redder]=rectarr[1];
				redder++;

				//selected=0;
				drag=true;
			}
			else	
			{	
				drag=true;
			}			
		}	
	}
	function mouseMove(event)
	{
		if(dotdragged==1)
		{
			if(dragdo==0)
			{
				ctx.clearRect(0,0,canvas.width,canvas.height);
				for(temp=0;temp<place;temp++)
				{
					if(temp!=whichdot)
					{
						ctx.beginPath();
						ctx.fillStyle="#000000"; 
						ctx.strokeStyle="#000000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}			
				}
				rectarr[2]=event.pageX-canvas.offsetLeft;
				rectarr[3]=event.pageY-canvas.offsetTop;
				ctx.beginPath();
				ctx.fillStyle="#000000"; 
				ctx.strokeStyle="#000000";
				ctx.arc(rectarr[2],rectarr[3],8,0,2*Math.PI);
				dotx[whichdot]=rectarr[2];
				doty[whichdot]=rectarr[3];
				for(temp=0;temp<redder;temp++)
				{
					if(whichdot==redindex[temp])
					{
						tempb=temp;
					}
				}
				redx[tempb]=rectarr[2];
				redy[tempb]=rectarr[3];
				selectarr[0]=rectarr[2];
				selectarr[1]=rectarr[3];
				selectdotplace=whichdot;
				ctx.fill();
				ctx.stroke();

				ctx.beginPath();
				ctx.fillStyle="#FF0000"; 
				ctx.strokeStyle="#FF0000";
				ctx.arc(selectarr[0],selectarr[1],8,0,2*Math.PI);
				ctx.fill();
				ctx.stroke();
			}
			else
			{
				ctx.clearRect(0,0,canvas.width,canvas.height);
				redraw=0;
				rectarr[2]=event.pageX-canvas.offsetLeft;
				rectarr[3]=event.pageY-canvas.offsetTop;
				deltx=rectarr[2]-rectarr[0];
				delty=rectarr[3]-rectarr[1];
				for(temp=0;temp<place;temp++)
				{
					redraw=0;
					for(tempa=0;tempa<redder;tempa++)
					{
						if(redindex[tempa]==temp)
						{
							redraw=1;
						}
					}
					if(redraw==0)
					{
						ctx.beginPath();
						ctx.fillStyle="#000000"; 
						ctx.strokeStyle="#000000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
				}
				for(temp=0;temp<redder;temp++)
				{
					redx[temp]=redx[temp]+deltx;
					redy[temp]=redy[temp]+delty;
					dotx[redindex[temp]]=dotx[redindex[temp]]+deltx;
					doty[redindex[temp]]=doty[redindex[temp]]+delty;
				}
				for(temp=0;temp<redder;temp++)
				{
					ctx.beginPath();
					ctx.fillStyle="#FF0000"; 
					ctx.strokeStyle="#FF0000";
					ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
				rectarr[0]=rectarr[2];
				rectarr[1]=rectarr[3];
			}
		}
		else
		{
			if(drag)
			{
				dotter++;
				ctx.clearRect(0,0,canvas.width,canvas.height);
				for(temp=0;temp<place;temp++)
				{
					ctx.beginPath();
					ctx.fillStyle="#000000"; 
					ctx.strokeStyle="#000000";
					ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
				for(temp=0;temp<redder;temp++)
				{
					ctx.beginPath();
					ctx.fillStyle="#FF0000"; 
					ctx.strokeStyle="#FF0000";
					ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
				rectarr[2]=(event.pageX-canvas.offsetLeft)-rectarr[0];
				rectarr[3]=(event.pageY-canvas.offsetTop)-rectarr[1];
				rectarr[4]=rectarr[2]+rectarr[0];
				rectarr[5]=rectarr[3]+rectarr[1];
				ctx.beginPath();
				ctx.lineWidth="2";
				ctx.strokeStyle="#000000";
				ctx.setLineDash([6]);
				ctx.rect(rectarr[0],rectarr[1],rectarr[2],rectarr[3]);
				ctx.stroke();
				if(controlled==0)
				{
					redx=[];
					redindex=[];
					redy=[];
					redder=0;
				}
				else
				{
					tempx=[];
					tempy=[];
					tempindex=[];
					for(temp=0;temp<added;temp++)
					{
						tempx[temp]=redx[temp];
						tempy[temp]=redy[temp];
						tempindex[temp]=redindex[temp];
			
					}
					redx=[];
					redy=[];
					redindex=[];
					redx=tempx;
					redy=tempy;
					redindex=tempindex;
					redder=added;
				}
				lightemup();
			}
		}

	}
	function mouseUp(event)
	{
		alert(redder);
		dragdo=0;
		if(dotdragged==1)
		{
			isdot=0;
			whichdot=0;
			dotdragged=0;
		}
		else
		{
			if(dotter>15)
			{
				if(controlled==0)
				{
					ctx.beginPath();
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#000000"; 
						ctx.strokeStyle="#000000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
					selected=1;
					selectype=1;
					selectarr=rectarr;
					drag=false;
				}
				else
				{
					redx[redder]=dotx[selectdotplace];
					redy[redder]=doty[selectdotplace];
					redindex[redder]=selectdotplace;
					redder=redder++;
					ctx.beginPath();
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#000000"; 
						ctx.strokeStyle="#000000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
					selected=1;
					selectype=1;
					selectarr=rectarr;
					drag=false;
				}
			}
			else
			{
				if(selected==1)
				{
					if(controlled==0)
					{
						selected=0;
						drag=false;
						ctx.beginPath();
						ctx.clearRect(0,0,canvas.width,canvas.height);
						for(temp=0;temp<place;temp++)
						{
							ctx.beginPath();
							ctx.fillStyle="#000000"; 
							ctx.strokeStyle="#000000";
							ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
						for(temp=0;temp<redder;temp++)
						{
							ctx.beginPath();
							ctx.fillStyle="#FF0000"; 
							ctx.strokeStyle="#FF0000";
							ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
					}
					else
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(dotx[selectdotplace],doty[selectdotplace],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
						clicked(event);
						drag=false;
					}
				}
				else
				{
					clicked(event);
					drag=false;
				}	
			}	
			dotter=0;
		}
	}
	function lightemup()
	{
		for(temp=0;temp<place;temp++)
			{
				if(rectarr[0]<rectarr[4]&&rectarr[1]<rectarr[5])
				{
					if(dotx[temp]>rectarr[0]&&dotx[temp]<rectarr[4]&&doty[temp]>rectarr[1]&&doty[temp]<rectarr[5])
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
						redx[redder]=dotx[temp];
						redy[redder]=doty[temp];
						redindex[redder]=temp;
						redder++;
					}
				}
				if(rectarr[0]<rectarr[4]&&rectarr[1]>rectarr[5])
				{
					if(dotx[temp]>rectarr[0]&&dotx[temp]<rectarr[4]&&doty[temp]<rectarr[1]&&doty[temp]>rectarr[5])
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
						redx[redder]=dotx[temp];
						redy[redder]=doty[temp];
						redindex[redder]=temp;
						redder++;
					}
				}
				if(rectarr[0]>rectarr[4]&&rectarr[1]<rectarr[5])
				{
					if(dotx[temp]<rectarr[0]&&dotx[temp]>rectarr[4]&&doty[temp]>rectarr[1]&&doty[temp]<rectarr[5])
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
						redx[redder]=dotx[temp];
						redy[redder]=doty[temp];
						redindex[redder]=temp;
						redder++;
					}
				}
				else
				{
					if(dotx[temp]<rectarr[0]&&dotx[temp]>rectarr[4]&&doty[temp]<rectarr[1]&&doty[temp]>rectarr[5])
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
						redx[redder]=dotx[temp];
						redy[redder]=doty[temp];
						redindex[redder]=temp;
						redder++;
					}
				}
			}
	}
	function clicked(event)
	{
		var startX=event.pageX-canvas.offsetLeft;
		var startY=event.pageY-canvas.offsetTop;
		dotx[place]=startX;
		doty[place]=startY;
		place++;
		selected=1;
		selectype=0;
		selectarr[0]=startX;
		selectarr[1]=startY;
		selectdotplace=place;
		redx[redder]=startX;
		redy[redder]=startY;
		redindex[redder]=place-1;
		redder++;
		ctx.beginPath();
		ctx.fillStyle="#FF0000"; 
		ctx.strokeStyle="#FF0000";
		ctx.arc(startX,startY,8,0,2*Math.PI);
		ctx.fill();
	}
	function moveit(event)
	{
		if (selected==0)
		{
			return;
		}
		else
		{
			num=event.keyCode;
				if(num==37)
				{
					for(temp=0;temp<redder;temp++)
					{
						redx[temp]=redx[temp]-1;
					}
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						tempy=false;
						for(tempa=0;tempa<redder;tempa++)
						{
							if(redindex[tempa]==temp)
							{
								tempy=true;
							}
						}
						if(tempy==false)
						{
							ctx.beginPath();
							ctx.fillStyle="#000000"; 
							ctx.strokeStyle="#000000";
							ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
						else
						{
							dotx[temp]=dotx[temp]-1;
						}
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}

				}	
				if(num==38)
				{
					for(temp=0;temp<redder;temp++)
					{
						redy[temp]=redy[temp]-1;
					}
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						tempy=false;
						for(tempa=0;tempa<redder;tempa++)
						{
							if(redindex[tempa]==temp)
							{
								tempy=true;
							}
						}
						if(tempy==false)
						{
							ctx.beginPath();
							ctx.fillStyle="#000000"; 
							ctx.strokeStyle="#000000";
							ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
						else
						{
							doty[temp]=doty[temp]-1;
						}
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
		/*			ctx.beginPath();
					ctx.fillStyle="#FF0000"; 
					ctx.strokeStyle="#FF0000";
					ctx.arc(dotx[selectdotplace],doty[selectdotplace],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();*/
				}
				if(num==39)
				{
					for(temp=0;temp<redder;temp++)
					{
						redx[temp]=redx[temp]+1;
					}
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						tempy=false;
						for(tempa=0;tempa<redder;tempa++)
						{
							if(redindex[tempa]==temp)
							{
								tempy=true;
							}
						}
						if(tempy==false)
						{
							ctx.beginPath();
							ctx.fillStyle="#000000"; 
							ctx.strokeStyle="#000000";
							ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
						else
						{
							dotx[temp]=dotx[temp]+1;
						}
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
				/*	ctx.beginPath();
					ctx.fillStyle="#FF0000"; 
					ctx.strokeStyle="#FF0000";
					ctx.arc(dotx[selectdotplace],doty[selectdotplace],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();*/
				}
				if(num==40)
				{
					for(temp=0;temp<redder;temp++)
					{
						redy[temp]=redy[temp]+1;
					}
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						tempy=false;
						for(tempa=0;tempa<redder;tempa++)
						{
							if(redindex[tempa]==temp)
							{
								tempy=true;
							}
						}
						if(tempy==false)
						{
							ctx.beginPath();
							ctx.fillStyle="#000000"; 
							ctx.strokeStyle="#000000";
							ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
						else
						{
							doty[temp]=doty[temp]+1;
						}
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
				}
		}
	}
	function controla(event)
	{
		if(event.keyCode==65)
		{
			controlled=1;
		}
		if(event.keyCode==27)
		{
			selected=0;
			ctx.clearRect(0,0,canvas.width,canvas.height);
				for(temp=0;temp<place;temp++)
				{
					ctx.beginPath();
					ctx.fillStyle="#000000"; 
					ctx.strokeStyle="#000000";
					ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
		}
		if(event.keyCode==37 ||event.keyCode==38 ||event.keyCode==39 ||event.keyCode==40)
		{
			moveit(event);
		}
		if(event.keyCode==13)
		{
			alert(selected);
		}
	}
	function controlb()
	{
		controlled=0;
	}
	function cleared()
	{
		var canvas=document.getElementById("myCan");
		var ctx=canvas.getContext('2d');
		ctx.clearRect(0,0,canvas.width, canvas.height);
		dotx=[];
		doty=[];
		redx=[];
		redy=[];
		redder=0;
		redindex=[];
		place=0;
	}
	init();
</script>
<body onload="init()">
<h1 align="center"> This is a Canvas </h1>
<div>
<button id="clear" type=button class="pure-button" accesskey="c" onclick="cleared()"> <u>C</u>lear </button>
</div>
<canvas id="myCan" width="800" height="700" style="border: 1px solid black;">
</body >
<style>
	#clear
	{
		position:absolute;
		right:50%;
		top: 7%;
	}
	h1
	{
		
	}
	#myCan
	{
		position: absolute;
		right: 30%;
		top: 10%;
		outline:none;
	}
</style>
</html>