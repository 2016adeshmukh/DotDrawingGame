<html>
<title> Canvas Page </title>
<script type="text/javascript">	
	dotter=0;
	dotx=[];
	doty=[];
	place=0;
	temp=0;
	redx=[];
	redy=[];
	redder=0;
	addedx=[];
	addedy=[];
	added=0;
	reda=0;
	controlled=0;
	isdot=0;
	dotdragged=0;
	whichdot=0;
	selectype=0; 
	selected=0;
	selectarr=[];
	selectdotplace=0;
	redindex=[];
	dragcntrl=0;
	deltx=0;
	delty=0;
	once=0;
	c=0;
	tempr=0;
	whatis=0;
	temps=0;
	undodotx=[[]];
	undodoty=[[]];
	undoplace=[];
	undoredx=[[]];
	undoredy=[[]];
	undoredder=[[]];
	undostack=0;
	undodotx[undostack]=[];
	undodoty[undostack]=[];
	undoredx[undostack]=[];
	undoredy[undostack]=[];
	undoplace[undostack]=[];
	undoredder[undostack]=[];

	function init()
	{	
		canvas=document.getElementById("myCan");
		ctx=canvas.getContext('2d');
		rectarr=[];
		drag=false;
		canvas.addEventListener("mousedown", mouseDown, false);
		canvas.addEventListener("mouseup", mouseUp, false);
		canvas.addEventListener("mousemove", mouseMove, false);
		canvas.setAttribute('tabindex','0');
		canvas.focus();
		canvas.addEventListener("keydown", controla, false);
		canvas.addEventListener("keyup", controlb, false);
	}
	function checkdot()
	{
		for(temp=0;temp<place;temp++)
		{
			var checkx=Math.abs(rectarr[0]-dotx[temp]);
			var checky=Math.abs(rectarr[1]-doty[temp]);
			checkx=checkx*checkx;
			checky=checky*checky;
			var checkr=checkx+checky;
			if(checkr<64)
			{
				whichdot=temp;
				isdot=1;
			}
		}
	}
	function mouseDown(event)
	{
		added=redder;
		if(selected==1)
		{
			if(controlled==0)
			{
				selected=0;
				ctx.clearRect(0,0,canvas.width,canvas.height);
				for(temp=0;temp<place;temp++)
				{
					ctx.beginPath();
					ctx.fillStyle="#000000"; 
					ctx.strokeStyle="#000000";
					ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
				
			}
		}
		rectarr[0]=event.pageX-canvas.offsetLeft;
		rectarr[1]=event.pageY-canvas.offsetTop;
		checkdot();
		if(isdot==1)
		{
			tempdrag=0;
			dotdragged=1;
			selectarr[0]=rectarr[0];
			selectarr[1]=rectarr[1];
			for(temp=0;temp<redder;temp++)
			{
				if(whichdot==redindex[temp])
				{
					dragred=1;
					tempdrag=temp;
				}
			}
			if(dragred==0 && controlled==1)
			{
				redx[redder]=dotx[whichdot];
				redy[redder]=doty[whichdot];
				redindex[redder]=whichdot;
				redder++;
					ctx.beginPath();
					ctx.fillStyle="#FF0000"; 
					ctx.strokeStyle="#FF0000";
					ctx.arc(redx[redder-1],redy[redder-1],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
			}
			selectdotplace=whichdot;
			selected=1;
			selectype=0;
///selected
			if(controlled==1||dragred==1)
			{
				//redx[redder]=dotx[whichdot];
				//redy[redder]=doty[whichdot];
				//redindex[redder]=whichdot;
				//redder++;
				dragcntrl=1;
			}
			else
			{
				redx=[];
				redy=[];
				redindex=[];
				redder=0;
				redx[redder]=dotx[selectdotplace];
				redy[redder]=doty[selectdotplace];
				redindex[redder]=selectdotplace;
				redder++;
				ctx.beginPath();
					ctx.fillStyle="#FF0000"; 
					ctx.strokeStyle="#FF0000";
					ctx.arc(redx[redder-1],redy[redder-1],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
			}
			/*ctx.beginPath();
			ctx.strokeStyle="#FF0000";
			ctx.fillStyle="#FF0000";
			ctx.arc(dotx[whichdot],doty[whichdot],8,0,2*Math.PI);
			ctx.fill();
			ctx.stroke();*/
		}
		else
		{
			if(controlled==0)
			{
				for(temp=0;temp<place;temp++)
				{
					ctx.beginPath();
					ctx.fillStyle="#000000"; 
					ctx.strokeStyle="#000000";
					ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
				selectarr[0]=rectarr[0];
				selectarr[1]=rectarr[1];
				redx=[];
				redy=[];
				redindex=[];
				redder=0;
				//redx[redder]=rectarr[0];
				//redy[redder]=rectarr[1];
				//redder++;

				drag=true;
			}
			else	
			{	
				drag=true;
			}			
		}	
	}
	function mouseMove(event)
	{
		if(dotdragged==1)
		{
			if(dragcntrl==0&&dragred==0)
			{
				ctx.clearRect(0,0,canvas.width,canvas.height);
				for(temp=0;temp<place;temp++)
				{
					if(temp!=whichdot)
					{
						ctx.beginPath();
						ctx.fillStyle="#000000"; 
						ctx.strokeStyle="#000000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}			
				}
				rectarr[2]=event.pageX-canvas.offsetLeft;
				rectarr[3]=event.pageY-canvas.offsetTop;
				ctx.beginPath();
				ctx.fillStyle="#000000"; 
				ctx.strokeStyle="#000000";
				ctx.arc(rectarr[2],rectarr[3],8,0,2*Math.PI);
				dotx[whichdot]=rectarr[2];
				doty[whichdot]=rectarr[3];
				redx[redder-1]=rectarr[2];
				redy[redder-1]=rectarr[3];
				selectarr[0]=rectarr[2];
				selectarr[1]=rectarr[3];
				selectdotplace=whichdot;
				ctx.fill();
				ctx.stroke();

	////this is the change for select maybe
				ctx.beginPath();
				ctx.fillStyle="#FF0000"; 
				ctx.strokeStyle="#FF0000";
				ctx.arc(selectarr[0],selectarr[1],8,0,2*Math.PI);
				ctx.fill();
				ctx.stroke();
			}
			else
			{
				ctx.clearRect(0,0,canvas.width,canvas.height);
				tester=0;
				for(temp=0;temp<place;temp++)
				{
					tester=0;
					for(tempa=0;tempa<redder;tempa++)
					{
						if(temp==redindex[tempa])
						{
							tester=1;
						}
					}
					if(tester==0)
					{
						ctx.beginPath();
						ctx.fillStyle="#000000"; 
						ctx.strokeStyle="#000000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
					else
					{
						deltx=(event.pageX-canvas.offsetLeft)-rectarr[0];
						delty=(event.pageY-canvas.offsetTop)-rectarr[1];
						tempb=0;
						for(tempa=0;tempa<redder;tempa++)
						{
							if(redindex[tempa]==temp)
							{
								tempb=tempa;
							}
						}
						redx[tempb]=redx[tempb]+deltx;
						redy[tempb]=redy[tempb]+delty;
						dotx[temp]=dotx[temp]+deltx;
						doty[temp]=doty[temp]+delty;
					}
				}
				for(temp=0;temp<redder;temp++)
				{	
					ctx.beginPath();
					ctx.fillStyle="#FF0000"; 
					ctx.strokeStyle="#FF0000";
					ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
				rectarr[0]=rectarr[0]+deltx;
				rectarr[1]=rectarr[1]+delty;

			}
			
		}
		else
		{
			if(drag)
			{
				whatis=0;
				dotter++;
				ctx.clearRect(0,0,canvas.width,canvas.height);
				for(temp=0;temp<place;temp++)
				{
					ctx.beginPath();
					ctx.fillStyle="#000000"; 
					ctx.strokeStyle="#000000";
					ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
				for(temp=0;temp<redder;temp++)
				{
					ctx.beginPath();
					ctx.fillStyle="#FF0000"; 
					ctx.strokeStyle="#FF0000";
					ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
				rectarr[2]=(event.pageX-canvas.offsetLeft)-rectarr[0];
				rectarr[3]=(event.pageY-canvas.offsetTop)-rectarr[1];
				rectarr[4]=rectarr[2]+rectarr[0];
				rectarr[5]=rectarr[3]+rectarr[1];
				ctx.beginPath();
				ctx.lineWidth="2";
				ctx.strokeStyle="#000000";
				ctx.setLineDash([6]);
				ctx.rect(rectarr[0],rectarr[1],rectarr[2],rectarr[3]);
				ctx.stroke();
				if(controlled==0)
				{
					redx=[];
					redindex=[];
					redy=[];
					redder=0;
				}
				else
				{
					tempx=[];
					tempy=[];
					tempindex=[];
					for(temp=0;temp<added;temp++)
					{
						tempx[temp]=redx[temp];
						tempy[temp]=redy[temp];
						tempindex[temp]=redindex[temp];
			
					}
					redx=[];
					redy=[];
					redindex=[];
					redx=tempx;
					redy=tempy;
					redindex=tempindex;
					redder=added;
				}
				lightemup();
				whatis=1;
			}
		}

	}
	function mouseUp(event)
	{
		dragcntrl=0;
		dragred=0;
		deltx=0;
		delty=0;
		tempr=0;
		if(dotdragged==1)
		{
			isdot=0;
			whichdot=0;
			dotdragged=0;
			undosave();
		}
		else
		{
			if(dotter>15)
			{
				if(controlled==0)
				{
					ctx.beginPath();
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#000000"; 
						ctx.strokeStyle="#000000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
					selected=1;
					selectype=1;
					selectarr=rectarr;
					drag=false;
					undosave();
				}
				else
				{
					redx[redder]=dotx[selectdotplace];
					redy[redder]=doty[selectdotplace];
					redindex[redder]=selectdotplace;
					redder=redder++;
					ctx.beginPath();
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#000000"; 
						ctx.strokeStyle="#000000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
					selected=1;
					selectype=1;
					selectarr=rectarr;
					drag=false;
					undosave();
				}
			}
			else
			{
				if(selected==1)
				{
					if(controlled==0)
					{
						selected=0;
						drag=false;
						ctx.beginPath();
						ctx.clearRect(0,0,canvas.width,canvas.height);
						for(temp=0;temp<place;temp++)
						{
							ctx.beginPath();
							ctx.fillStyle="#000000"; 
							ctx.strokeStyle="#000000";
							ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
						for(temp=0;temp<redder;temp++)
						{
							ctx.beginPath();
							ctx.fillStyle="#FF0000"; 
							ctx.strokeStyle="#FF0000";
							ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
						undosave();
					}
					else
					{
						once=0;
						clicked(event);
						drag=false;
						undosave();
					}
				}
				else
				{
					clicked(event);
					drag=false;
					undosave();
				}	
			}	
			dotter=0;
		}
			
	}
	function lightemup()
	{
		for(temp=0;temp<place;temp++)
			{
			for(tempa=0;tempa<redder;tempa++)
			{
				if(temp==redindex[tempa])
				{
					tempr=1;
				}
			}
			if(tempr==0)
			{
				if(rectarr[0]<rectarr[4]&&rectarr[1]<rectarr[5])
				{
					if(dotx[temp]>rectarr[0]&&dotx[temp]<rectarr[4]&&doty[temp]>rectarr[1]&&doty[temp]<rectarr[5])
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
						redx[redder]=dotx[temp];
						redy[redder]=doty[temp];
						redindex[redder]=temp;
						redder++;
					}
				}
				if(rectarr[0]<rectarr[4]&&rectarr[1]>rectarr[5])
				{
					if(dotx[temp]>rectarr[0]&&dotx[temp]<rectarr[4]&&doty[temp]<rectarr[1]&&doty[temp]>rectarr[5])
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
						redx[redder]=dotx[temp];
						redy[redder]=doty[temp];
						redindex[redder]=temp;
						redder++;
					}
				}
				if(rectarr[0]>rectarr[4]&&rectarr[1]<rectarr[5])
				{
					if(dotx[temp]<rectarr[0]&&dotx[temp]>rectarr[4]&&doty[temp]>rectarr[1]&&doty[temp]<rectarr[5])
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
						redx[redder]=dotx[temp];
						redy[redder]=doty[temp];
						redindex[redder]=temp;
						redder++;
					}
				}
				else
				{
					if(dotx[temp]<rectarr[0]&&dotx[temp]>rectarr[4]&&doty[temp]<rectarr[1]&&doty[temp]>rectarr[5])
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
						redx[redder]=dotx[temp];
						redy[redder]=doty[temp];
						redindex[redder]=temp;
						redder++;
					}
				}
			}
			tempr=0;
			}
	}
	function clicked(event)
	{
		whatis=0;
		var startX=event.pageX-canvas.offsetLeft;
		var startY=event.pageY-canvas.offsetTop;
		dotx[place]=startX;
		doty[place]=startY;
		place++;
		selected=1;
		selectype=0;
		selectarr[0]=startX;
		selectarr[1]=startY;
		selectdotplace=place;
		redx[redder]=startX;
		redy[redder]=startY;
		ctx.beginPath();
		ctx.fillStyle="#FF0000"; 
		ctx.strokeStyle="#FF0000";
		ctx.arc(startX,startY,8,0,2*Math.PI);
		ctx.fill();
		redindex[redder]=place-1;
		redder++;
		
	}
	function moveit(event)
	{
		if (selected==0)
		{
			return;
		}
		else
		{
			num=event.keyCode;
				if(num==37)
				{
					for(temp=0;temp<redder;temp++)
					{
						redx[temp]=redx[temp]-1;
					}
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						tempy=false;
						for(tempa=0;tempa<redder;tempa++)
						{
							if(redindex[tempa]==temp)
							{
								tempy=true;
							}
						}
						if(tempy==false)
						{
							ctx.beginPath();
							ctx.fillStyle="#000000"; 
							ctx.strokeStyle="#000000";
							ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
						else
						{
							dotx[temp]=dotx[temp]-1;
						}
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}

				}	
				if(num==38)
				{
					for(temp=0;temp<redder;temp++)
					{
						redy[temp]=redy[temp]-1;
					}
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						tempy=false;
						for(tempa=0;tempa<redder;tempa++)
						{
							if(redindex[tempa]==temp)
							{
								tempy=true;
							}
						}
						if(tempy==false)
						{
							ctx.beginPath();
							ctx.fillStyle="#000000"; 
							ctx.strokeStyle="#000000";
							ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
						else
						{
							doty[temp]=doty[temp]-1;
						}
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
				}
				if(num==39)
				{
					for(temp=0;temp<redder;temp++)
					{
						redx[temp]=redx[temp]+1;
					}
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						tempy=false;
						for(tempa=0;tempa<redder;tempa++)
						{
							if(redindex[tempa]==temp)
							{
								tempy=true;
							}
						}
						if(tempy==false)
						{
							ctx.beginPath();
							ctx.fillStyle="#000000"; 
							ctx.strokeStyle="#000000";
							ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
						else
						{
							dotx[temp]=dotx[temp]+1;
						}
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
				}
				if(num==40)
				{
					for(temp=0;temp<redder;temp++)
					{
						redy[temp]=redy[temp]+1;
					}
					ctx.clearRect(0,0,canvas.width,canvas.height);
					for(temp=0;temp<place;temp++)
					{
						tempy=false;
						for(tempa=0;tempa<redder;tempa++)
						{
							if(redindex[tempa]==temp)
							{
								tempy=true;
							}
						}
						if(tempy==false)
						{
							ctx.beginPath();
							ctx.fillStyle="#000000"; 
							ctx.strokeStyle="#000000";
							ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
							ctx.fill();
							ctx.stroke();
						}
						else
						{
							doty[temp]=doty[temp]+1;
						}
					}
					for(temp=0;temp<redder;temp++)
					{
						ctx.beginPath();
						ctx.fillStyle="#FF0000"; 
						ctx.strokeStyle="#FF0000";
						ctx.arc(redx[temp],redy[temp],8,0,2*Math.PI);
						ctx.fill();
						ctx.stroke();
					}
				}
		}
	}
	function controla(event)
	{
		if(event.ctrlKey || event.keyCode==65)
		{
			if(c==0)
			{
				controlled=1;
				C=1;
			}
		}
		if(event.keyCode==27)
		{
			selected=0;
			redx=[];
			redy=[];
			redindex=[];
			redder=0;
			ctx.clearRect(0,0,canvas.width,canvas.height);
				for(temp=0;temp<place;temp++)
				{
					ctx.beginPath();
					ctx.fillStyle="#000000"; 
					ctx.strokeStyle="#000000";
					ctx.arc(dotx[temp],doty[temp],8,0,2*Math.PI);
					ctx.fill();
					ctx.stroke();
				}
				undosave();
		}
		if(event.keyCode==37 ||event.keyCode==38 ||event.keyCode==39 ||event.keyCode==40)
		{
			event.preventDefault();
			moveit(event);
		}
	}
	function controlb(event)
	{
		controlled=0;
		c=0;
		if(event.keyCode==37 || event.keyCode==38 || event.keyCode==39|| event.keyCode==40)
		{
			undosave();
		}
	}
	function cleared()
	{
		var canvas=document.getElementById("myCan");
		var ctx=canvas.getContext('2d');
		ctx.clearRect(0,0,canvas.width, canvas.height);
		dotx=[];
		doty=[];
		redx=[];
		redy=[];
		redder=0;
		redindex=[];
		place=0;
		undodotx=[];
		undodoty=[];
		undoplace=[];
		undoredx=[];
		undoredy=[];
		undoredder=[];
		undostack=0;
	}
	function undosave()
	{
		undostack++;
		undodotx[undostack]=dotx;
		undodoty[undostack]=doty;
		undoplace[undostack]=place;
		undoredx[undostack]=redx;
		undoredy[undostack]=redy;
		undoredder[undostack]=redder;
		drag=false;
	}
	function undoit()
	{
		ctx.clearRect(0,0,canvas.width,canvas.height);
		var needit=undostack-1;
		place=undoplace[needit];
		dotx=undodotx[needit];
		doty=undodoty[needit];
		redder=undoredder[needit];
		redx=undoredx[needit];
		redy=undoredy[needit];
		for(temp=0;temp<undoplace[needit];temp++)
		{
			ctx.beginPath();
			ctx.fillStyle="#000000"; 
			ctx.strokeStyle="#000000";
			var tempx=undodotx[needit][temp];
			var tempy=undodoty[needit][temp];
			ctx.arc(tempx,tempy,8,0,2*Math.PI);
			ctx.fill();
			ctx.stroke();
		}
		for(temp=0;temp<undoredder[needit];temp++)
		{
			ctx.beginPath();
			ctx.fillStyle="#FF0000"; 
			ctx.strokeStyle="#FF0000";
			var tempx=undoredx[needit][temp];
			var tempy=undoredy[needit][temp];
			ctx.arc(tempx,tempy,8,0,2*Math.PI);
			ctx.fill();
			ctx.stroke();
		}
		undostack--;
		drag=false;
	}
	init();
</script>
<body onload="init()">
<h1 align="center"> This is a Canvas </h1>
<div>
<button id="clear" type=button class="pure-button" accesskey="c" onclick="cleared()"> <u>C</u>lear </button>
<button id="undo" type=button class="pure-button" accesskey="u" onclick="undoit()"> <u>U</u>ndo </button>
</div>
<canvas id="myCan" width="900" height="900" style="border: 1px solid black;">
</body >
<style>
	#clear
	{
		position:absolute;
		right:44%;
		top: 7%;
	}
	h1
	{
	}
	#undo
	{
		position:absolute;
		right:54%;
		top:7%;
	}
	#myCan
	{
		position: absolute;
		right: 30%;
		top: 10%;
		outline:none;
	}
</style>
</html>